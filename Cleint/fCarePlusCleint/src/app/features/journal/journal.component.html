<form [formGroup]="voucherForm" (ngSubmit)="saveVoucher()">
  <div class="voucher-header">
    <div class="form-group">
      <label for="JournalDate">ุชุงุฑูุฎ ุงูููุฏ:</label>
      <input id="JournalDate" type="date" formControlName="JournalDate" required>
      <div *ngIf="voucherForm.get('JournalDate')?.invalid && voucherForm.get('JournalDate')?.touched" class="error-message" style="color: red;">
        ุงูุชุงุฑูุฎ ูุทููุจ.
      </div>
    </div>

    <div class="form-group">
      <label for="JournalDescription">ูุตู ุงูููุฏ ุงูุนุงู:</label>
      <textarea id="JournalDescription" formControlName="JournalDescription" rows="3" required></textarea>
      <div *ngIf="voucherForm.get('JournalDescription')?.invalid && voucherForm.get('JournalDescription')?.touched" class="error-message" style="color: red;">
        ุงููุตู ูุทููุจ.
      </div>
    </div>
  </div>

  <hr>

  <h3>ุชูุงุตูู ุงูููุฏ</h3>

  <div formArrayName="Details" class="table-responsive">
    <table class="table details-table">
      <thead>
        <tr>
          <th>#</th>
          <th>ุฑูู/ุงุณู ุงูุญุณุงุจ</th>
          <th>ูุฏูู (Debit)</th>
          <th>ุฏุงุฆู (Credit)</th>
          <th>ุจูุงู ุชูุตููู</th>
          <th>ุฅุฌุฑุงุก</th>
        </tr>
      </thead>
      <tbody>
        <tr ย*ngFor="let detailRow of detailsArray.controls; let i = index" [formGroup]="detailRow">

          <td>{{ i + 1 }}</td>
          <td >
            <input
              type="text"
              formControlName="AccountDisplay"
              placeholder="ุงุจุญุซ ุนู ุญุณุงุจ (ุงุณู ุฃู ุฑูู)"
              required
              (input)="handleSearchInput($event, i)" >
            <input type="hidden" formControlName="AccountId">
            <div class="autocomplete-dropdown" *ngIf="suggestions[i] && suggestions[i].length > 0" style="position: absolute; z-index: 10; background-color: #eeeeee; height: 150px; overflow-y: auto; border: 1px solid #ccc; width: 300px;">
              <div
                  *ngFor="let account of suggestions[i]"
                  (click)="onAccountSelected(account, i)"
                  class="autocomplete-item "
              >{{ account.fullAccountName }} </div>
            </div>

            <div *ngIf="detailRow.get('AccountDisplay')?.invalid && detailRow.get('AccountDisplay')?.touched" class="error-message" style="color: red;">
                ูุฌุจ ุงุฎุชูุงุฑ ุญุณุงุจ.
            </div>
          </td>
          <td>
            <input type="number"  formControlName="DebitAmount" min="0">
            <div *ngIf="detailRow.get('DebitAmount')?.hasError('min') && detailRow.get('DebitAmount')?.touched"
              class="error-message " style="color: red;">
              ูุง ูููู ุฅุฏุฎุงู ุฑูู ุณุงูุจ.
            </div>
          </td>
          <td>
            <input type="number" formControlName="CreditAmount" min="0">
            <div *ngIf="detailRow.get('CreditAmount')?.hasError('min') && detailRow.get('CreditAmount')?.touched"
              class="error-message " style="color: red;">
              ูุง ูููู ุฅุฏุฎุงู ุฑูู ุณุงูุจ.
          </div>
          </td>
          <td>
            <input type="text" formControlName="DetailStatement" placeholder="ุจูุงู ุชูุตููู (ุงุฎุชูุงุฑู)">
          </td>
          <td>
            <button
              type="button"
              class="btn btn-danger btn-sm"
              (click)="removeRow(i)"
              [disabled]="detailsArray.length === 1"
              title="ุญุฐู ุงูุตู">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="voucher-footer">
    <div class="totals-section">
      <div>
        <label>ุงูุฅุฌูุงูู ุงููุฏูู:</label>
        <input type="text" formControlName="TotalDebit" readonly class="total-debit">
      </div>
      <div>
        <label>ุงูุฅุฌูุงูู ุงูุฏุงุฆู:</label>
        <input type="text" formControlName="TotalCredit" readonly class="total-credit">
      </div>
      <div [class.difference-error]="voucherForm.get('Difference')?.value !== 0">
        <label>ุงููุฑู (ูุฌุจ ุฃู ูููู ุตูุฑ):</label>
        <input type="text" formControlName="Difference" readonly class="difference">
      </div>
    </div>

    <div class="actions-section">
      <button type="button" (click)="addRow()" class="btn-add">
        โ ุฅุถุงูุฉ ุตู ุฌุฏูุฏ
      </button>
      <button type="submit" [disabled]="voucherForm.invalid "
        class="btn-save">
        ๐พ ุญูุธ ุงูููุฏ
      </button>
      <!-- <button type="submit"
        class="btn-save">
        ๐พ ุญูุธ ุงูููุฏ
      </button> -->
    </div>
  </div>

</form>


